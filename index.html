<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MathProject [BySansiAsaf]</title>

<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@600&display=swap');

html,body{
margin:0;
padding:0;
overflow:hidden;
background:black;
font-family:'Orbitron',sans-serif;
color:white;
}

canvas{
position:fixed;
top:0;
left:0;
}

#score{
position:fixed;
top:20px;
left:50%;
transform:translateX(-50%);
font-size:36px;
z-index:5;
text-shadow:0 0 15px #c77dff;
}

#intro{
position:fixed;
inset:0;
display:flex;
align-items:center;
justify-content:center;
background:black;
font-size:54px;
z-index:20;
transition:opacity 1s;
}

#questionBox{
position:fixed;
top:8%;
left:50%;
transform:translateX(-50%);
width:600px;
background:rgba(0,0,0,0.95);
padding:25px;
border-radius:20px;
display:none;
flex-direction:column;
gap:15px;
z-index:10;
box-shadow:0 0 40px #c77dff;
}

.choice{
background:#240046;
padding:14px;
border-radius:12px;
cursor:pointer;
transition:.2s;
}

.choice:hover{
background:#3c096c;
}

#solution{
color:#ffd60a;
white-space:pre-line;
}

#nextBtn{
background:gold;
border:none;
padding:12px;
border-radius:12px;
font-weight:bold;
cursor:pointer;
display:none;
}
</style>
</head>
<body>

<div id="intro">Omer Asaf</div>
<div id="score">0</div>

<div id="questionBox">
<div id="qText"></div>
<div id="choices"></div>
<div id="solution"></div>
<button id="nextBtn">Başka soruya geç</button>
</div>

<canvas id="game"></canvas>

<script>
/* ============================
   CANVAS SETUP
============================ */

const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

function resize(){
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

/* ============================
   GAME STATE
============================ */

const STATE = {
PLAYING:0,
QUESTION:1
};

let gameState = STATE.PLAYING;

let bird = {
x:80,
y:canvas.height/3,
vel:0,
size:55
};

let gravity = 900;
let jumpForce = -350;

let pipes = [];
let pipeGap = 220;
let pipeWidth = 110;
let pipeSpawnTimer = 0;
let pipeSpawnDelay = 1.8;

let score = 0;

let lastTime = 0;

/* ============================
   QUESTION SYSTEM
============================ */

let questions = [];
let remainingQuestions = [];

function generateQuestions(){
for(let i=0;i<110;i++){
let a=Math.floor(Math.random()*9+2);
let b=Math.floor(Math.random()*9+2);
let c=Math.floor(Math.random()*9+2);

let type=Math.random()>0.5?"Doğru Orantı":"Ters Orantı";
let answer;

if(type==="Doğru Orantı"){
answer = Math.round((b*c)/a);
}else{
answer = Math.round((a*b)/c);
}

questions.push({
q:`${a} işçi ${b} günde iş bitiriyor. ${c} işçi kaç günde bitirir? (${type})`,
correct:answer,
solution: type==="Doğru Orantı"
? `Doğru Orantı: ${a}/${b} = ${c}/x\nx = ${answer}`
: `Ters Orantı: ${a}×${b} = ${c}×x\nx = ${answer}`
});
}

remainingQuestions = [...questions];
}
generateQuestions();

function showQuestion(){
if(remainingQuestions.length===0){
remainingQuestions=[...questions];
}

gameState = STATE.QUESTION;

const box=document.getElementById("questionBox");
box.style.display="flex";

const index=Math.floor(Math.random()*remainingQuestions.length);
const q=remainingQuestions[index];
remainingQuestions.splice(index,1);

document.getElementById("qText").textContent=q.q;
document.getElementById("solution").textContent="";
document.getElementById("nextBtn").style.display="none";

const choicesDiv=document.getElementById("choices");
choicesDiv.innerHTML="";

let answers=[q.correct];

while(answers.length<4){
let fake=q.correct+Math.floor(Math.random()*20-10);
if(fake!==q.correct && fake>0 && !answers.includes(fake)){
answers.push(fake);
}
}

answers.sort(()=>Math.random()-0.5);

const letters=["A)","B)","C)","D)"];

answers.forEach((ans,i)=>{
let div=document.createElement("div");
div.className="choice";
div.textContent=`${letters[i]} ${ans}`;
div.onclick=()=>{
if(ans===q.correct){
box.style.display="none";
resetGame();
gameState=STATE.PLAYING;
}else{
document.getElementById("solution").textContent=
`Yanlış!\n\n${q.solution}\n\n*Uyarı: Başka soruya geç*`;
document.getElementById("nextBtn").style.display="block";
}
};
choicesDiv.appendChild(div);
});
}

document.getElementById("nextBtn").onclick=()=>{
document.getElementById("questionBox").style.display="none";
showQuestion(); // gerçekten yeni soru
};

/* ============================
   GAME RESET
============================ */

function resetGame(){
bird.y=canvas.height/3;
bird.vel=0;
pipes=[];
score=0;
}

/* ============================
   INPUT
============================ */

function jump(){
if(gameState===STATE.PLAYING){
bird.vel = jumpForce;
}
}
window.addEventListener("mousedown",jump);
window.addEventListener("touchstart",jump);

/* ============================
   GAME LOOP (DELTA TIME)
============================ */

function gameLoop(timestamp){
let delta=(timestamp-lastTime)/1000;
lastTime=timestamp;

update(delta);
draw();

requestAnimationFrame(gameLoop);
}

function update(dt){

if(gameState!==STATE.PLAYING) return;

bird.vel += gravity*dt;
bird.y += bird.vel*dt;

pipeSpawnTimer+=dt;
if(pipeSpawnTimer>pipeSpawnDelay){
pipeSpawnTimer=0;
spawnPipe();
}

pipes.forEach(p=>{
p.x-=250*dt;

if(!p.scored && p.x+pipeWidth<bird.x){
p.scored=true;
score++;
}

if(collide(p)){
showQuestion();
}
});

pipes=pipes.filter(p=>p.x>-pipeWidth);

if(bird.y<0 || bird.y+bird.size>canvas.height){
showQuestion();
}
}

function spawnPipe(){
let topHeight=Math.random()*(canvas.height-300)+50;
pipes.push({
x:canvas.width,
top:topHeight,
bottom:topHeight+pipeGap,
scored:false
});
}

function collide(p){
return bird.x < p.x+pipeWidth &&
bird.x+bird.size > p.x &&
(bird.y < p.top || bird.y+bird.size > p.bottom);
}

function draw(){
ctx.clearRect(0,0,canvas.width,canvas.height);

ctx.fillStyle="#c77dff";
ctx.fillRect(bird.x,bird.y,bird.size,bird.size);

ctx.fillStyle="#3a0ca3";
pipes.forEach(p=>{
ctx.fillRect(p.x,0,pipeWidth,p.top);
ctx.fillRect(p.x,p.bottom,pipeWidth,canvas.height-p.bottom);
});

document.getElementById("score").textContent=score;
}

/* ============================
   INTRO ANIMATION
============================ */

setTimeout(()=>{document.getElementById("intro").textContent="Tarafından Geliştirildi";},2000);
setTimeout(()=>{document.getElementById("intro").textContent="Matematik Projesi";},4000);
setTimeout(()=>{
document.getElementById("intro").style.opacity=0;
setTimeout(()=>{document.getElementById("intro").style.display="none";},1000);
},6000);

requestAnimationFrame(gameLoop);
</script>
</body>
</html>
