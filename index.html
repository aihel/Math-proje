<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber Math Bird</title>

<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    background:black;
    font-family:Arial;
    color:white;
}

canvas{ position:fixed; inset:0; }

#score{
    position:fixed;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    font-size:26px;
    text-shadow:0 0 12px #c77dff;
}

#questionBox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.92);
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:14px;
    text-align:center;
    padding:20px;
}

.choice{
    background:#240046;
    padding:12px;
    border-radius:10px;
    width:240px;
    box-shadow:0 0 12px #c77dff;
}
.solution{
    font-size:14px;
    opacity:.85;
    max-width:320px;
}
</style>
</head>

<body>

<div id="score">0</div>

<div id="questionBox">
    <div id="qText"></div>
    <div id="choices"></div>
    <div id="solution" class="solution"></div>
</div>

<canvas id="game"></canvas>
<audio id="music" src="assets/88.m4a" loop></audio>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize(); window.onresize=resize;
function resize(){ canvas.width=innerWidth; canvas.height=innerHeight; }

const bg=new Image(); bg.src="assets/bg.svg";
const pipeImg=new Image(); pipeImg.src="assets/pipe.svg";

const birdFrames=[
    new Image(),
    new Image(),
    new Image()
];
birdFrames[0].src="assets/1.png";
birdFrames[1].src="assets/2.png";
birdFrames[2].src="assets/3.png";

let birdY=300, velocity=0, pipes=[], score=0, running=true;
const SIZE=58;

function jump(){
    document.getElementById("music").play().catch(()=>{});
    velocity=-10;
}

canvas.addEventListener("touchstart",jump);
canvas.addEventListener("mousedown",jump);

function addPipe(){
    const top=Math.random()*(canvas.height-320)+40;
    pipes.push({x:canvas.width, top});
}
setInterval(addPipe,2000);

function generateQuestion(){
    const type=Math.random()>0.5?"dogru":"ters";
    const a=Math.floor(Math.random()*9)+2;
    const b=Math.floor(Math.random()*9)+2;
    const c=Math.floor(Math.random()*9)+2;

    if(type==="dogru"){
        const result=(b*c)/a;
        return {
            q:`${a} işçi ${b} günde yapıyorsa ${c} işçi kaç günde yapar?`,
            correct:result,
            solution:`Doğru orantı: işçi artarsa süre azalır.\n(${b}×${a})/${c} = ${result}`
        };
    } else {
        const result=(a*b)/c;
        return {
            q:`${a} musluk ${b} saatte doldurursa ${c} musluk kaç saatte doldurur?`,
            correct:result,
            solution:`Ters orantı: musluk artarsa süre azalır.\n(${a}×${b})/${c} = ${result}`
        };
    }
}

function ask(){
    running=false;
    const qb=document.getElementById("questionBox");
    qb.style.display="flex";
    const data=generateQuestion();
    document.getElementById("qText").textContent=data.q;
    document.getElementById("solution").textContent="";

    const ch=document.getElementById("choices");
    ch.innerHTML="";
    const answers=[
        Math.round(data.correct),
        Math.round(data.correct*1.5),
        Math.round(data.correct*0.5)
    ].sort(()=>Math.random()-0.5);

    answers.forEach(ans=>{
        const d=document.createElement("div");
        d.className="choice";
        d.textContent=ans;
        d.onclick=()=>{
            if(ans===Math.round(data.correct)){
                qb.style.display="none";
                running=true;
            } else {
                document.getElementById("solution").textContent=data.solution;
                score=0;
            }
        };
        ch.appendChild(d);
    });
}

function loop(){
    requestAnimationFrame(loop);

    ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    velocity+=0.6;
    birdY+=velocity;

    let frame=0;
    if(velocity<-2) frame=1;
    else if(velocity>2) frame=2;

    ctx.drawImage(birdFrames[frame],80,birdY,SIZE,SIZE);

    pipes.forEach(p=>{
        p.x-=3;
        ctx.drawImage(pipeImg,p.x,0,90,p.top);
        ctx.drawImage(pipeImg,p.x,p.top+170,90,canvas.height);

        if(80>p.x && 80<p.x+90){
            if(birdY<p.top || birdY>p.top+170) ask();
        }
    });

    pipes=pipes.filter(p=>p.x>-120);
}
loop();
</script>
</body>
</html>
