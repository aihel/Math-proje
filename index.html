<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title> Math Project BySansiAsaf </title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Audiowide&display=swap');

html,body{margin:0;padding:0;overflow:hidden;font-family:'Audiowide', sans-serif;background:black;color:white;}
canvas{position:fixed;top:0;left:0;}
#score{position:fixed;top:20px;left:50%;transform:translateX(-50%);font-size:35px;text-shadow:0 0 14px #c77dff;z-index:5;}
#intro{
    position:fixed;inset:0;background:rgba(0,0,0,0.9);display:flex;
    align-items:center;justify-content:center;flex-direction:column;font-size:52px;
    color:#c77dff;text-shadow:0 0 20px #fff;z-index:15;opacity:1;
    transition:opacity 1s ease;text-align:center;
}
#questionBox{
    position:fixed;top:10%;left:50%;transform:translateX(-50%);
    width:500px;background:rgba(0,0,0,0.95);border-radius:15px;
    display:none;flex-direction:column;align-items:center;justify-content:center;
    gap:16px;text-align:center;padding:24px;z-index:10;
}
.choice{
    background:#240046;padding:16px;border-radius:12px;width:100%;
    box-shadow:0 0 14px #c77dff;margin:6px 0;cursor:pointer;font-size:18px;text-align:center;
}
.choice:hover{background:#3c096c;}
.solution{font-size:16px;opacity:.9;max-width:450px;margin-top:8px;white-space:pre-line;}
</style>
</head>
<body>

<video id="bgVideo" autoplay loop muted playsinline style="position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;">
    <source src="assets/smol-stelle-honkai-star-rail.1920x1080.mp4" type="video/mp4">
</video>

<div id="intro">Omer Asaf</div>
<div id="score">0</div>
<div id="questionBox">
    <div id="qText"></div>
    <div id="choices"></div>
    <div id="solution" class="solution"></div>
</div>

<canvas id="game"></canvas>
<audio id="music" src="assets/88.m4a" loop></audio>

<script>
// CANVAS
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

window.addEventListener("resize",()=>{
    canvas.width=window.innerWidth;
    canvas.height=window.innerHeight;
});

// SPRITES
const birdFrames=[new Image(),new Image(),new Image()];
birdFrames[0].src="assets/1.png";
birdFrames[1].src="assets/2.png";
birdFrames[2].src="assets/3.png";

const pipeBottom=new Image(); pipeBottom.src="assets/pipe.svg";
const pipeTop=new Image(); pipeTop.src="assets/pipe1.svg"; // ters pipe

// GAME STATE
let birdY=canvas.height/4, velocity=0, pipes=[], score=0, running=false;
const SIZE=58;
let pipeIndex=0;
const pipeOrder = [100,150,180,120,160,200,140,170,130,190,110,160,175,125,180,145,155,165,185,195];

// INPUT
function jump(){velocity=-9; document.getElementById("music").play().catch(()=>{});}
canvas.addEventListener("touchstart",jump);
canvas.addEventListener("mousedown",jump);

// RESET GAME
function resetGame(){
    birdY=canvas.height/4;
    velocity=0;
    pipes=[];
    score=0;
    pipeIndex=0;
    remainingQuestions=[...questions];
    running=true;
}

// ADD PIPE
function addPipe(){
    const gap=200;
    const top = pipeOrder[pipeIndex % pipeOrder.length];
    pipes.push({x:canvas.width, top:top, gap:gap, scored:false});
    pipeIndex++;
}
setInterval(()=>{if(running)addPipe();},2000);

// QUESTIONS
let questions = [];
const basicQ=[
    {q:"5 kalem 20 TL ise 8 kalem kaç TL? (Doğru Orantı)", correct:32},
    {q:"3 işçi bir duvarı 9 günde örüyorsa 9 işçi kaç günde örer? (Ters Orantı)", correct:3},
    {q:"Otobüs 90 km/s hızla 4 saatte gidiyor. Aynı yolu 60 km/s ile kaç saatte gider? (Ters Orantı)", correct:6},
    {q:"4 kg portakal 24 TL ise 7 kg kaç TL? (Doğru Orantı)", correct:42},
    {q:"2 işçi 12 günde bitirirse 4 işçi kaç günde? (Ters Orantı)", correct:6},
    {q:"5 kg elma 35 TL ise 8 kg kaç TL? (Doğru Orantı)", correct:56},
    {q:"3 işçi 15 günde iş bitirirse 5 işçi kaç günde? (Ters Orantı)", correct:9}
];
while(basicQ.length<90){
    let a=Math.floor(Math.random()*10+2);
    let b=Math.floor(Math.random()*10+2);
    let c=Math.floor(Math.random()*10+2);
    const type = Math.random()>0.5?"Doğru Orantı":"Ters Orantı";
    const ans = type=="Doğru Orantı"?Math.round(b*a/c):Math.round(a*b/c);
    basicQ.push({q:`${a} işçi ${b} günde yapıyorsa ${c} işçi kaç günde yapar? (${type})`, correct:ans});
}
let remainingQuestions = [...basicQ];

// ASK FUNCTION
function ask(){
    if(remainingQuestions.length===0){remainingQuestions = [...basicQ];} 
    running=false;
    const qb=document.getElementById("questionBox");
    qb.style.display="flex";
    
    const idx=Math.floor(Math.random()*remainingQuestions.length);
    const q=remainingQuestions[idx];
    remainingQuestions.splice(idx,1);
    
    document.getElementById("qText").textContent=q.q;
    document.getElementById("solution").textContent="";
    const ch=document.getElementById("choices");
    ch.innerHTML="";
    
    let choices = [q.correct];
    while(choices.length<4){
        let rand=Math.floor(q.correct*0.5+Math.random()*q.correct*1.5);
        if(!choices.includes(rand)) choices.push(rand);
    }
    choices.sort(()=>Math.random()-0.5);
    
    choices.forEach(ans=>{
        const d=document.createElement("div");
        d.className="choice";
        d.textContent=ans;
        d.onclick=()=>{
            qb.style.display="none"; 
            resetGame(); 
            if(ans!==q.correct){ document.getElementById("solution").textContent=`Yanlış! Çözüm: ${q.correct}`;}
        };
        ch.appendChild(d);
    });
}

// INTRO
const intro=document.getElementById("intro");
setTimeout(()=>{intro.textContent="Tarafından Geliştirildi";},2000);
setTimeout(()=>{intro.textContent="Matamatik Projesi";},4000);
setTimeout(()=>{intro.style.opacity=0; setTimeout(()=>{intro.style.display="none"; running=true;},800);},6000);

// GAME LOOP
function loop(){
    requestAnimationFrame(loop);
    ctx.clearRect(0,0,canvas.width,canvas.height);

    if(running){
        velocity+=0.38;
        birdY+=velocity;

        // Bird frame seçimi
        let frame=0;
        if(velocity<-2) frame=1;
        else if(velocity>2) frame=2;
        ctx.drawImage(birdFrames[frame],80,birdY,SIZE,SIZE);

        // PIPE
        pipes.forEach((p)=>{
            p.x-=2.85;

            ctx.drawImage(pipeTop,p.x,p.top-520*1.1,110*1.1,520*1.1);
            ctx.drawImage(pipeBottom,p.x,p.top+p.gap,110*1.1,520*1.1);

            // hitbox
            if(80>p.x+20 && 80< p.x+110*1.1-20 && (birdY<p.top || birdY>p.top+p.gap)){
                ask();
            }

            // SKOR
            if(!p.scored && p.x + 110*1.1/2 < 80){
                score++;
                p.scored=true;
            }
        });
        pipes=pipes.filter(p=>p.x>-140);

        // Bird sınırları
        if(birdY+SIZE>canvas.height || birdY<0){
            ask();
        }

        document.getElementById("score").textContent=score;
    }
}
loop();
</script>
</body>
</html>
