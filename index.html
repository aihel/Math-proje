<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cyber Math Bird</title>
<style>
html,body{
    margin:0;
    padding:0;
    overflow:hidden;
    font-family:Arial, sans-serif;
    background:black;
    color:white;
}

canvas{position:fixed;inset:0;}

#score{
    position:fixed;
    top:20px;
    left:50%;
    transform:translateX(-50%);
    font-size:30px;
    text-shadow:0 0 14px #c77dff;
    z-index:5;
}

#questionBox{
    position:fixed;
    top:10%;
    left:50%;
    transform:translateX(-50%);
    width:400px;
    background:rgba(0,0,0,0.9);
    border-radius:15px;
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    gap:16px;
    text-align:center;
    padding:24px;
    z-index:10;
}

.choice{
    background:#240046;
    padding:14px;
    border-radius:12px;
    width:100%;
    box-shadow:0 0 14px #c77dff;
    margin:6px 0;
    cursor:pointer;
    font-size:18px;
    text-align:center;
}
.choice:hover{background:#3c096c;}
.solution{
    font-size:16px;
    opacity:.85;
    max-width:360px;
    margin-top:8px;
    white-space:pre-line;
}
</style>
</head>
<body>

<!-- Video Background -->
<video id="bgVideo" autoplay loop muted playsinline style="
    position:fixed;
    top:0; left:0;
    width:100%;
    height:100%;
    object-fit:cover;
    z-index:-1;">
    <source src="assets/smol-stelle-honkai-star-rail.1920x1080.mp4" type="video/mp4">
</video>

<div id="score">0</div>
<div id="questionBox">
    <div id="qText"></div>
    <div id="choices"></div>
    <div id="solution" class="solution"></div>
</div>

<canvas id="game"></canvas>
<audio id="music" src="assets/88.m4a" loop></audio>

<script>
// CANVAS SETUP
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize(); window.onresize=resize;
function resize(){ canvas.width=innerWidth*1.3; canvas.height=innerHeight*1.3; }

// SPRITES
const birdFrames=[new Image(),new Image(),new Image()];
birdFrames[0].src="assets/1.png";
birdFrames[1].src="assets/2.png";
birdFrames[2].src="assets/3.png";

const pipeImg=new Image(); pipeImg.src="assets/pipe.svg";

// GAME STATE
let birdY=300, velocity=0, pipes=[], score=0, running=true;
const SIZE=58;

// INPUT
function jump(){
    document.getElementById("music").play().catch(()=>{});
    velocity=-10;
}
canvas.addEventListener("touchstart",jump);
canvas.addEventListener("mousedown",jump);

// PIPE GENERATION
function addPipe(){
    const gap=200;
    const minHeight=100;
    const maxHeight=canvas.height-gap-100;
    const top=Math.floor(Math.random()*(maxHeight-minHeight+1)+minHeight);
    pipes.push({x:canvas.width, top:top, gap:gap});
}
setInterval(addPipe,2200);

// QUESTIONS (90+ örnek, çoğaltabilirsiniz)
const questions=[
    {q:"5 kalem 20 TL ise 8 kalem kaç TL?", choices:["30","32","40"], correct:1, solution:"5 kalem 20 TL → 1 kalem 4 TL → 8 kalem 8×4=32 TL"},
    {q:"3 işçi bir duvarı 9 günde örüyorsa 9 işçi kaç günde örer?", choices:["3","9","27"], correct:0, solution:"İşçi arttı → gün azalır: 3×9=27 → 9 işçi 27/9=3 gün"},
    {q:"Otobüs 90 km/s hızla 4 saatte gidiyor. Aynı yolu 60 km/s ile kaç saatte gider?", choices:["4","6","8"], correct:1, solution:"90*4=360 km → 60 km/s → 360/60=6 saat"}
];
// 90+ soru üretmek için
while(questions.length<90){
    let a=Math.floor(Math.random()*10+2);
    let b=Math.floor(Math.random()*10+2);
    let c=Math.floor(Math.random()*10+2);
    questions.push({q:`${a} işçi ${b} günde yapıyorsa ${c} işçi kaç günde yapar?`, choices:[Math.round(b*a/c),Math.round(b*a/c)+1,Math.round(b*a/c)+2], correct:0, solution:`Doğru orantı: işçi artarsa süre azalır. (${b}×${a})/${c}=${Math.round(b*a/c)}`});
}

// ASK FUNCTION
function ask(){
    running=false;
    const qb=document.getElementById("questionBox");
    qb.style.display="flex";
    const q=questions[Math.floor(Math.random()*questions.length)];
    document.getElementById("qText").textContent=q.q;
    document.getElementById("solution").textContent="";
    const ch=document.getElementById("choices");
    ch.innerHTML="";
    q.choices.forEach((ans,i)=>{
        const d=document.createElement("div");
        d.className="choice";
        d.textContent=ans;
        d.onclick=()=>{
            if(i===q.correct){
                qb.style.display="none";
                running=true;
            } else {
                document.getElementById("solution").textContent=q.solution;
                score=0;
            }
        };
        ch.appendChild(d);
    });
}

// GAME LOOP
function loop(){
    requestAnimationFrame(loop);
    if(!running) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    velocity+=0.6;
    birdY+=velocity;

    // BIRD FRAME SEÇİMİ
    let frame=0;
    if(velocity<-2) frame=1;
    else if(velocity>2) frame=2;
    ctx.drawImage(birdFrames[frame],80,birdY,SIZE,SIZE);

    // PİPE ÇİZİMİ
    pipes.forEach(p=>{
        p.x-=3;
        // Üst pipe
        ctx.drawImage(pipeImg,p.x,0,90,p.top);
        // Alt pipe
        ctx.drawImage(pipeImg,p.x,p.top+p.gap,90,canvas.height);
        // Çarpışma kontrolü
        if(80>p.x && 80<p.x+90){
            if(birdY<p.top || birdY>p.top+p.gap) ask();
        }
    });

    // Pipe temizleme
    pipes=pipes.filter(p=>p.x>-120);

    // Skor
    score+=0.02;
    document.getElementById("score").textContent=Math.floor(score);
}
setInterval(addPipe,2200);
loop();
</script>
</body>
</html>
