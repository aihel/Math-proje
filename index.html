<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Math(Meth)ProjectBySansiAsaf</title>
<style>
html,body{margin:0;padding:0;overflow:hidden;font-family:Arial;background:black;color:white;}
canvas{position:fixed;inset:0;}
#score{position:fixed;top:20px;left:50%;transform:translateX(-50%);font-size:35px;text-shadow:0 0 14px #c77dff;z-index:5;}
#intro{
    position:fixed;inset:0;background:rgba(0,0,0,0.85);display:flex;
    align-items:center;justify-content:center;flex-direction:column;font-size:48px;
    color:#c77dff;text-shadow:0 0 12px #fff;z-index:15;opacity:1;
    transition:opacity 0.8s ease;
}
#questionBox{
    position:fixed;top:10%;left:50%;transform:translateX(-50%);
    width:450px;background:rgba(0,0,0,0.92);border-radius:15px;
    display:none;flex-direction:column;align-items:center;justify-content:center;
    gap:16px;text-align:center;padding:24px;z-index:10;
}
.choice{
    background:#240046;padding:14px;border-radius:12px;width:100%;
    box-shadow:0 0 14px #c77dff;margin:6px 0;cursor:pointer;font-size:18px;text-align:center;
}
.choice:hover{background:#3c096c;}
.solution{font-size:16px;opacity:.85;max-width:360px;margin-top:8px;white-space:pre-line;}
</style>
</head>
<body>

<!-- Video Background -->
<video id="bgVideo" autoplay loop muted playsinline style="position:fixed;top:0;left:0;width:100%;height:100%;object-fit:cover;z-index:-1;">
    <source src="assets/smol-stelle-honkai-star-rail.1920x1080.mp4" type="video/mp4">
</video>

<div id="intro">Omer Asaf</div>
<div id="score">0</div>
<div id="questionBox">
    <div id="qText"></div>
    <div id="choices"></div>
    <div id="solution" class="solution"></div>
</div>

<canvas id="game"></canvas>
<audio id="music" src="assets/88.m4a" loop></audio>

<script>
// CANVAS SETUP
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
resize(); window.onresize=resize;
function resize(){ canvas.width=innerWidth*1.4; canvas.height=innerHeight*1.4; }

// SPRITES
const birdFrames=[new Image(),new Image(),new Image()];
birdFrames[0].src="assets/1.png";
birdFrames[1].src="assets/2.png";
birdFrames[2].src="assets/3.png";
const pipeImg=new Image(); pipeImg.src="assets/pipe.svg";

// GAME STATE
let birdY=canvas.height/2, velocity=0, pipes=[], score=0, running=false, passedPipeIndex=-1;
const SIZE=58;

// INPUT
function jump(){velocity=-10; document.getElementById("music").play().catch(()=>{});}
canvas.addEventListener("touchstart",jump);
canvas.addEventListener("mousedown",jump);

// PIPE SEQUENCE
const pipeOrder = [];
const pipePositions=[100,150,200,250,300,350,400,450,500,550,600,120,170,220,270,320,370,420,470,520];
for(let i=0;i<pipePositions.length;i++){pipeOrder.push(pipePositions[i]);}
let pipeIndex=0;

function resetGame(){
    birdY=canvas.height/2; velocity=0; pipes=[]; score=0; passedPipeIndex=-1; pipeIndex=0; running=true;
}
function addPipe(){
    const gap=200;
    const top = pipeOrder[pipeIndex % pipeOrder.length];
    pipes.push({x:canvas.width, top:top, gap:gap});
    pipeIndex++;
}
setInterval(()=>{if(running)addPipe();},2200);

// QUESTIONS
const questions=[];
// Basit örnek + random üretme
while(questions.length<90){
    let a=Math.floor(Math.random()*10+2);
    let b=Math.floor(Math.random()*10+2);
    let c=Math.floor(Math.random()*10+2);
    questions.push({q:`${a} işçi ${b} günde yapıyorsa ${c} işçi kaç günde yapar?`,
                    choices:[Math.round(b*a/c),Math.round(b*a/c)+1,Math.round(b*a/c)+2],
                    correct:0,
                    solution:`Doğru orantı: işçi artarsa süre azalır. (${b}×${a})/${c}=${Math.round(b*a/c)}`});
}

// ASK FUNCTION
function ask(){
    running=false;
    const qb=document.getElementById("questionBox");
    qb.style.display="flex";
    const q=questions[Math.floor(Math.random()*questions.length)];
    document.getElementById("qText").textContent=q.q;
    document.getElementById("solution").textContent="";
    const ch=document.getElementById("choices");
    ch.innerHTML="";
    q.choices.forEach((ans,i)=>{
        const d=document.createElement("div");
        d.className="choice";
        d.textContent=ans;
        d.onclick=()=>{
            if(i===q.correct){ qb.style.display="none"; running=true; }
            else { document.getElementById("solution").textContent=q.solution; score=0; }
        };
        ch.appendChild(d);
    });
}

// INTRO ANIMATION
const intro=document.getElementById("intro");
setTimeout(()=>{intro.textContent="Tarafından Geliştirildi";},2000);
setTimeout(()=>{intro.textContent="Matamatik Projesi";},4000);
setTimeout(()=>{intro.style.opacity=0; setTimeout(()=>{intro.style.display="none"; running=true;},800);},6000);

// GAME LOOP
function loop(){
    requestAnimationFrame(loop);
    if(!running) return;

    ctx.clearRect(0,0,canvas.width,canvas.height);

    // BIRD
    velocity+=0.6; birdY+=velocity;
    let frame=0;
    if(velocity<-2) frame=1;
    else if(velocity>2) frame=2;
    ctx.drawImage(birdFrames[frame],80,birdY,SIZE,SIZE);

    // PIPES
    pipes.forEach((p,i)=>{
        p.x-=3;
        ctx.drawImage(pipeImg,p.x,0,90,p.top);
        ctx.drawImage(pipeImg,p.x,p.top+p.gap,90,canvas.height);
        // Çarpışma
        if(80>p.x && 80<p.x+90 && (birdY<p.top || birdY>p.top+p.gap)) ask();
        // Skor sadece pipe geçince
        if(p.x + 90 < 80 && passedPipeIndex<i){
            score++; passedPipeIndex=i;
        }
    });
    pipes=pipes.filter(p=>p.x>-120);

    // Skor
    document.getElementById("score").textContent=score;

    // Ölüm / reset
    if(birdY>canvas.height || birdY<0){resetGame();}
}
loop();
</script>
</body>
</html>
