<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Bird Math Edition</title>

<style>
body{
    margin:0;
    overflow:hidden;
    font-family:Arial;
    background:black;
}
canvas{ display:block; }

#questionBox{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.95);
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    gap:25px;
    text-align:center;
    color:white;
}

.choice{
    width:260px;
    padding:12px;
    font-size:1.1em;
    border:none;
    border-radius:10px;
    cursor:pointer;
}

#solution{
    font-size:1em;
    opacity:0.9;
    max-width:600px;
}

#intro{
    position:fixed;
    inset:0;
    background:black;
    display:flex;
    justify-content:center;
    align-items:center;
    font-size:4em;
    color:yellow;
    font-weight:bold;
}
</style>
</head>
<body>

<canvas id="canvas"></canvas>

<div id="questionBox">
    <h2 id="questionText"></h2>

    <button class="choice" onclick="selectAnswer(0)" id="c0"></button>
    <button class="choice" onclick="selectAnswer(1)" id="c1"></button>
    <button class="choice" onclick="selectAnswer(2)" id="c2"></button>
    <button class="choice" onclick="selectAnswer(3)" id="c3"></button>

    <div id="solution"></div>
</div>

<div id="intro">ByOmerAsaf</div>

<audio loop autoplay>
    <source src="88.m4a" type="audio/m4a">
</audio>

<script>
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

function resizeCanvas(){
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener("resize",resizeCanvas);
resizeCanvas();

function load(name){ const img = new Image(); img.src="sprites/"+name; return img; }

const bg = load("background-day.png");
const baseImg = load("base.png");
const pipeImg = load("pipe-green.png");
const messageImg = load("message.png");
const gameoverImg = load("gameover.png");

const birdFrames = [
    load("yellowbird-upflap.png"),
    load("yellowbird-midflap.png"),
    load("yellowbird-downflap.png")
];

const scoreDigits = {
    "0": load("00000.png"),
    "1": load("111.png"),
    "2": load("99999.png"),
    "3": load("33.png"),
    "4": load("44.png"),
    "5": load("55.png"),
    "6": load("66.png"),
    "7": load("77.png"),
    "8": load("88.png"),
    "9": load("99.png")
};

/* =================== QUESTIONS =================== */

const questions = [];

for(let i=0;i<90;i++){
    let a=Math.floor(Math.random()*8)+2;
    let b=Math.floor(Math.random()*9)+1;
    let correct=b;

    let choices = [
        correct,
        correct+1,
        Math.max(1, correct-1),
        correct+2
    ].sort(()=>Math.random()-0.5);

    questions.push({
        q:`${a} işçi bir işi ${b*2} günde yapıyor. İşçi sayısı ${a*2} olursa kaç günde biter?`,
        correct:correct.toString(),
        choices:choices.map(x=>x.toString()),
        sol:`İşçi sayısı artarsa süre azalır (ters orantı). Süre yarıya iner → ${b}`
    });
}

let usedQuestions=[];
let currentQuestion=null;

/* =================== GAME =================== */

let bird, pipes, state="intro", score=0;

function resetGame(){
    bird = {x:canvas.width*0.2, y:canvas.height*0.4, vy:0, frame:0};
    pipes=[];
    score=0;
}

resetGame();

function spawnPipe(){
    let top=Math.random()*(canvas.height*0.5)+80;
    pipes.push({x:canvas.width,top,scored:false});
}
setInterval(()=>{ if(state==="play") spawnPipe(); },2000);

/* =================== INTRO =================== */

let introFrames=0;
function introLoop(){
    introFrames++;
    if(introFrames<180){
        requestAnimationFrame(introLoop);
    }else{
        document.getElementById("intro").style.display="none";
        state="menu";
    }
}
introLoop();

/* =================== INPUT =================== */

canvas.addEventListener("click",()=>{
    if(state==="menu"){
        resetGame();
        state="play";
        bird.vy=-7;
        return;
    }
    if(state==="play"){
        bird.vy=-7;
    }
});

/* =================== QUESTIONS =================== */

function askQuestion(){

    document.getElementById("questionBox").style.display="flex";

    do{
        currentQuestion = questions[Math.floor(Math.random()*questions.length)];
    }while(usedQuestions.includes(currentQuestion));

    usedQuestions.push(currentQuestion);

    document.getElementById("questionText").innerText=currentQuestion.q;
    document.getElementById("solution").innerText="";

    currentQuestion.choices.forEach((c,i)=>{
        document.getElementById("c"+i).innerText=c;
    });
}

function selectAnswer(i){
    const val=currentQuestion.choices[i];

    if(val===currentQuestion.correct){
        document.getElementById("questionBox").style.display="none";
        countdownStart();
    }else{
        document.getElementById("solution").innerText="Yanlış! " + currentQuestion.sol;
        setTimeout(()=>{
            document.getElementById("questionBox").style.display="none";
            state="menu";
        },2000);
    }
}

/* =================== COUNTDOWN =================== */

function countdownStart(){
    let count=3;
    state="countdown";

    const t=setInterval(()=>{
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.drawImage(bg,0,0,canvas.width,canvas.height);

        ctx.fillStyle="white";
        ctx.font=`${Math.floor(canvas.height*0.2)}px Arial`;
        ctx.textAlign="center";
        ctx.fillText(count,canvas.width/2,canvas.height/2);

        count--;

        if(count<0){
            clearInterval(t);
            resetGame();
            state="play";
        }
    },1000);
}

/* =================== UPDATE =================== */

function update(){
    if(state!=="play") return;

    bird.vy+=0.4;
    bird.y+=bird.vy;
    bird.frame+=0.2;

    pipes.forEach(p=>{
        p.x-=2;

        if(
            bird.x+40>p.x &&
            bird.x<p.x+60 &&
            (bird.y<p.top || bird.y+30>p.top+170)
        ){
            state="gameover";
            setTimeout(()=>askQuestion(),500);
        }

        if(!p.scored && p.x+60<bird.x){
            score++;
            p.scored=true;
        }
    });

    if(bird.y>canvas.height-50 || bird.y<0){
        state="gameover";
        setTimeout(()=>askQuestion(),500);
    }
}

/* =================== DRAW =================== */

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    ctx.drawImage(bg,0,0,canvas.width,canvas.height);

    pipes.forEach(p=>{
        ctx.drawImage(pipeImg,p.x,p.top-400,60,400);
        ctx.drawImage(pipeImg,p.x,p.top+170,60,400);
    });

    if(state!=="menu" && state!=="countdown"){
        ctx.drawImage(birdFrames[Math.floor(bird.frame)%3],bird.x,bird.y,40,30);
    }

    ctx.drawImage(baseImg,0,canvas.height-50,canvas.width,50);

    if(state==="menu"){
        ctx.drawImage(messageImg,canvas.width/2-110,canvas.height/2-60,220,120);
    }

    if(state==="gameover"){
        ctx.drawImage(gameoverImg,canvas.width/2-120,canvas.height/2-60,240,120);
    }

    drawScore();
}

function drawScore(){
    let s=score.toString();
    for(let i=0;i<s.length;i++){
        ctx.drawImage(scoreDigits[s[i]], 20+i*50, 20, 50, 50);
    }
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
