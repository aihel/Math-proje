<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Flappy Math</title>

<style>
body{
  margin:0;
  overflow:hidden;
  background:black;
  font-family:Arial;
}

#bgVideo{
  position:fixed;
  width:100%;
  height:100%;
  object-fit:cover;
  z-index:-1;
}

canvas{
  display:block;
  margin:auto;
}
</style>
</head>
<body>

<video id="bgVideo" autoplay loop muted>
  <source src="bg.mp4" type="video/mp4">
</video>

<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

canvas.width = 1000;   // Arena genişletildi
canvas.height = 650;

const pipeImg = new Image();
pipeImg.src = "pipe.svg";

const pipeTopImg = new Image();
pipeTopImg.src = "pipe1.svg";

let gravity = 0.4;
let velocity = 0;
let birdY = 250;
let birdX = 200;

let pipeGap = 200;
let pipeWidth = 110;
let pipes = [];
let score = 0;

function resetGame(){
  pipes = [];
  score = 0;
  birdY = 200; // biraz yukardan başlat
  velocity = 0;
}

function spawnPipe(){
  let topHeight = Math.random() * 250 + 50;

  pipes.push({
    x: canvas.width,
    top: topHeight,
    bottom: canvas.height - topHeight - pipeGap,
    passed:false
  });
}

setInterval(spawnPipe, 2000);

function update(){
  velocity += gravity;
  birdY += velocity;

  if(birdY > canvas.height){
    resetGame();
  }

  pipes.forEach(pipe=>{
    pipe.x -= 3;

    // skor sadece geçince
    if(!pipe.passed && pipe.x + pipeWidth < birdX){
      score++;
      pipe.passed = true;
    }

    // çarpma kontrolü (hitbox küçültüldü)
    if(
      birdX + 30 > pipe.x + 10 &&
      birdX < pipe.x + pipeWidth - 10 &&
      (
        birdY < pipe.top - 10 ||
        birdY + 30 > pipe.top + pipeGap + 10
      )
    ){
      resetGame();
    }
  });
}

function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  // bird
  ctx.fillStyle = "yellow";
  ctx.beginPath();
  ctx.arc(birdX,birdY,15,0,Math.PI*2);
  ctx.fill();

  // pipes
  pipes.forEach(pipe=>{
    // üst pipe
    ctx.drawImage(
      pipeTopImg,
      pipe.x,
      pipe.top - 520,
      pipeWidth,
      520
    );

    // alt pipe
    ctx.drawImage(
      pipeImg,
      pipe.x,
      pipe.top + pipeGap,
      pipeWidth,
      520
    );
  });

  ctx.fillStyle="white";
  ctx.font="30px Arial";
  ctx.fillText("Skor: "+score,20,40);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();

document.addEventListener("keydown",()=>{
  velocity = -8;
});

document.addEventListener("click",()=>{
  velocity = -8;
});
</script>

</body>
</html>
